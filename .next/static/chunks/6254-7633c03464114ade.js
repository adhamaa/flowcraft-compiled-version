"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6254],{25690:function(e,t){t.Z=[]},84280:function(e,t){t.Z=[]},19660:function(e,t,o){var n=o(66628),r=o(8793),a=o(25755);t.Z={success:e=>{a.N9.show({icon:(0,n.jsx)(r.JO,{icon:"heroicons-solid:check-circle",width:"2rem",height:"2rem"}),message:e,classNames:{root:"before:bg-transparent rounded-lg",icon:"bg-white text-teal-400"}})},error:e=>{a.N9.show({icon:(0,n.jsx)(r.JO,{icon:"heroicons-solid:x-circle",width:"2rem",height:"2rem"}),message:e,classNames:{root:"before:bg-transparent rounded-lg",icon:"bg-white text-red-400"}})},warning:e=>{a.N9.show({icon:(0,n.jsx)(r.JO,{icon:"heroicons-solid:exclamation-circle",width:"2rem",height:"2rem"}),message:e,classNames:{root:"before:bg-transparent rounded-lg",icon:"bg-white text-yellow-400"}})}}},95559:function(e,t,o){o.d(t,{nK:function(){return n},pi:function(){return a},sg:function(){return r}});let n=e=>e&&0===Object.keys(e).length&&e.constructor===Object;function r(e,t){let o={};return e.forEach(e=>{var t;o[e.id]={stage_name:e.data.label,stage_uuid:e.id,list_prev:[],list_next:[],duplicate_from:null!==(t=e.data.duplicate_from)&&void 0!==t?t:""}}),t.forEach(e=>{o[e.target]&&o[e.target].list_prev.push(e.source),o[e.source]&&o[e.source].list_next.push(e.target)}),Object.values(o)}let a=e=>{let t=new Date,o=new Date(e),n=Math.floor((t.getTime()-o.getTime())/1e3);if(n<60)return"".concat(n," second").concat(1!==n?"s":""," ago");let r=Math.floor(n/60);if(r<60)return"".concat(r," minute").concat(1!==r?"s":""," ago");let a=Math.floor(r/60);if(a<24)return"".concat(a," hour").concat(1!==a?"s":""," ago");let c=Math.floor(a/24);if(c<7)return"".concat(c," day").concat(1!==c?"s":""," ago");let d=Math.floor(c/7);if(d<4)return"".concat(d," week").concat(1!==d?"s":""," ago");let s=Math.floor(c/30);if(s<12)return"".concat(s," month").concat(1!==s?"s":""," ago");let l=Math.floor(c/365);return"".concat(l," year").concat(1!==l?"s":""," ago")}},80184:function(e,t,o){o.d(t,{A6:function(){return D},AY:function(){return a},B7:function(){return f},BI:function(){return v},Cp:function(){return w},GL:function(){return b},GX:function(){return $},JZ:function(){return s},Jx:function(){return M},M3:function(){return d},M_:function(){return O},PA:function(){return I},U1:function(){return g},Vh:function(){return E},Vp:function(){return C},X8:function(){return j},Xc:function(){return m},Xi:function(){return r},ZU:function(){return k},_y:function(){return i},bp:function(){return l},d5:function(){return S},ek:function(){return P},in:function(){return h},mY:function(){return c},ow:function(){return Z},q2:function(){return N},w9:function(){return u},xO:function(){return _},xn:function(){return p},xq:function(){return x},zm:function(){return y}}),o(63804);var n=o(44233),r=(0,n.$)("07fd71094c296382131ae74ad2984e00ce014dd9"),a=(0,n.$)("272b96a42ca94b0191405494003aadd08bad2365"),c=(0,n.$)("080ae4ee1f297589b0b9f25700ffb47f48782773"),d=(0,n.$)("9186f8e8ceec5e51c05d4ac327faebfe4ccf1129");(0,n.$)("427b730a1474e16aa451e977ddc02a8478a6b3f9");var s=(0,n.$)("61744b7b22be68545c3fd130ca85876d778429bc"),l=(0,n.$)("e87ef483b03d2ea9c078ed8a0ba274d92e78c23c"),i=(0,n.$)("cff6238c54e9f361e591c1e66a5135903bbfe4dd"),u=(0,n.$)("d6ca4ac908d414c7211ff320e7b16220034e3c7d"),f=(0,n.$)("b757b35b35a4386a4b9092be080773453389b5cb"),g=(0,n.$)("eba7413b57e02171d30406fe4947a0f7eb2703d6"),b=(0,n.$)("1428ed7ab66a956a38055adf6a8df43170874fc6"),p=(0,n.$)("0c5fd6b8e75d1a94b0bf92d7f9ad7844e74cf977"),h=(0,n.$)("77933a84b28cf622b2dba02d40a09f313e30651e"),m=(0,n.$)("d7c528da49173659187a5fb5cec24f22cab9072a"),y=(0,n.$)("6beb8ddf854fa69c122b86a91c0265c64c43cc33"),v=(0,n.$)("c78a5d8e11445e9dac53429f6e05b8081b8ebd4a"),w=(0,n.$)("962ce742d5cb17f22d59012020621ac1bcf8952e"),N=(0,n.$)("709fa232a4839ca0bb20ccfc5b6d90e1f0040dbe"),I=(0,n.$)("ee9cb352c81cb3c8bbdec486b3f10b4e42c86098"),x=(0,n.$)("a9ce1efcd83a14cd21a0aed41b576f46ccd29e5d"),E=(0,n.$)("b8605e39846778e97f8d7b4a921473b43af6fa0a"),C=(0,n.$)("16fca09bfdb8f96d2e5db151935a834b59321e93"),$=(0,n.$)("0d7f0367dd3a12bb447e43aba28788d912a59c5a"),S=(0,n.$)("8217098c211656db7c520ab598f5428a2ed3dc7c"),_=(0,n.$)("cf93e1eef89c4a1f4152c54b96c183350fe4549a"),D=(0,n.$)("ce28763aee675e78b47316181eaf8241762aead9");(0,n.$)("123f4f142bcba1cfe87c3b814eeb78f8c2db0b1e"),(0,n.$)("261680d6fd1955cfb9d7c1180581aa708211695d");var O=(0,n.$)("698785d5b061b1ea5d2ca4cc0e5833f8bdfeb022"),P=(0,n.$)("9c7de0d66f94886f4cbd73da7ea0cfd7dece9a2b"),k=(0,n.$)("6c5a5dccba5b23ec6f3bce22d68e8464e8e5eb54"),Z=(0,n.$)("552bbbe68d63eebb15cbfe2fa618ad3358cdb19b"),M=(0,n.$)("696bd584de94b84a6dc6458ad598b7d451d9a707"),j=(0,n.$)("7881f0128f8964dffab5baf936228e68cff1d349")},66254:function(e,t,o){var n=o(8551),r=o(56031),a=o(75698),c=o(57445),d=o.n(c),s=o(77669),l=o(84280),i=o(25690),u=o(80184),f=o(89958),g=o(95559),b=o(19660),p=o(89815);let h=new(d()).graphlib.Graph;h.setDefaultEdgeLabel(()=>({}));let m=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TB",n="LR"===o;return h.setGraph({rankdir:o}),e.forEach(e=>{h.setNode(e.id,{width:250,height:200})}),t.forEach(e=>{h.setEdge(e.source,e.target)}),d().layout(h),e.forEach(e=>{let t=h.node(e.id);return e.targetPosition=n?"left":"top",e.sourcePosition=n?"right":"bottom",e.position={x:t.x-125,y:t.y-100},e}),{nodes:e,edges:t}},y=(0,n.Ue)()((0,a.tJ)((e,t)=>({flowKey:"wip-flow",currentCycleInfo:{},nodes:l.Z,edges:i.Z,rfInstance:null,generateNodeId:()=>crypto.randomUUID(),getSelectedNodeId:()=>{var e;return null===(e=t().nodes.find(e=>e.selected))||void 0===e?void 0:e.id},deselectAllNodes:()=>{e({nodes:t().nodes.map(e=>({...e,selected:!1}))})},getInputOptionsByNodesId:e=>{let{nodes:o}=t();return o.filter(t=>e.includes(t.id)).map(e=>({value:e.id,label:e.data.label}))},getInputOptions:e=>e?e.map(e=>({value:e.stage_uuid,label:e.stage_name})):t().nodes.map(e=>({value:e.id,label:e.data.label})),getPreviousInputOptions:()=>{let e=t().getSelectedNodeId(),o=t().getPreviousNodesId(e);return t().getInputOptionsByNodesId(o)},getNextInputOptions:()=>{let e=t().getSelectedNodeId(),o=t().getNextNodesId(e);return t().getInputOptionsByNodesId(o)},getPreviousNodesId:e=>{var o;let{nodes:n,edges:r}=t();return e=null!=e?e:null===(o=n.find(e=>e.selected))||void 0===o?void 0:o.id,r.filter(t=>t.target===e).map(e=>e.source)},getNextNodesId:e=>{var o;let{nodes:n,edges:r}=t();return e=null!=e?e:null===(o=n.find(e=>e.selected))||void 0===o?void 0:o.id,r.filter(t=>t.source===e).map(e=>e.target)},onNodesChange:o=>{e({nodes:(0,s.Fb)(o,t().nodes)})},onEdgesChange:o=>{e({edges:(0,s.yn)(o,t().edges)})},onConnect:o=>{e({edges:(0,s.Z_)(o,t().edges)})},onLayout:o=>{let{nodes:n,edges:r}=m(t().nodes,t().edges,o);e({nodes:n,edges:r})},onSave:async e=>{let{cycle_uuid:o,callback:n}=e,r=t().onDraft;(0,t().onLayout)("TB"),p.qk.openConfirmModal({title:"Save Cycle",children:"Are you confirm to save this cycle to the latest one? ",labels:{cancel:"Cancel",confirm:"Save"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:async()=>{try{if(!o)throw Error("Cycle UUID is required.");let e=(0,g.sg)(t().nodes,t().edges);r(),await (0,u.Vp)({cycle_uuid:o,body:e}).then(t=>{if(t.error)throw Error(t.error_message);b.Z.success(t.message),null==n||n({success:!0,message:t.message,data:{cycle_uuid:o,...e}})})}catch(t){var e;b.Z.error(null!==(e=t.message)&&void 0!==e?e:"An error occurred while saving the cycle.")}}})},onDraft:()=>{let e=t().rfInstance,o=t().flowKey;if(e){let t=e.toObject();localStorage.setItem(o,JSON.stringify(t))}},onApply:e=>{let{action:o,data:n,callback:r}=e,a=t().onAdd,c=t().onMove,d=t().onDuplicate,s=t().onDelete,l=t().onRestore,i=t().onDisjoint;switch(o){case"add":a(n);break;case"move":c(n);break;case"duplicate":d(n);break;case"delete":s();break;case"restore":l(n);break;case"disjoint":i(n)}"function"==typeof r&&r()},onReset:o=>{let n=t().rfInstance,r=t().flowKey,a=async()=>{let t=JSON.parse(localStorage.getItem(r));if(t){let{x:r=0,y:a=0,zoom:c=1}=t.viewport;e({nodes:t.nodes||[],edges:t.edges||[]}),null==n||n.setViewport({x:r,y:a,zoom:c}),"function"==typeof o&&o()}};p.qk.openConfirmModal({title:"Reset Cycle",children:"Are you sure you want to reset this cycle to the previous one? You canâ€™t undo this action.",labels:{cancel:"Cancel",confirm:"Reset"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:a})},onAdd:o=>{let{curr_stage_name:n="New Node",curr_stage_uuid:r,previous_stage:a,next_stage:c}=o,d=t().updateEdges;try{if(!n)throw Error("Stage name is required.");let s={id:r,type:"Standard",data:{label:n},position:{x:Math.random()*window.innerWidth-50,y:Math.random()*window.innerHeight-50}};e({nodes:[...t().nodes,s]}),(a||c)&&d({...o,curr_stage_uuid:r})}catch(e){b.Z.error(e.message)}},onMove:e=>{var o;let{previous_stage:n,next_stage:r}=e,{nodes:a,removeEdges:c,updateEdges:d}=t(),s=null===(o=a.find(e=>e.selected))||void 0===o?void 0:o.id;try{if(!s)throw Error("No selected stage found or stage does not exist.");if(0===n.length&&0===r.length)throw Error("Pick at least one previous or next stage to move the selected stage.");c(s),d(e)}catch(e){b.Z.error(e.message)}},onDuplicate:o=>{let{previous_stage:n,next_stage:r}=o,a=t().generateNodeId(),{nodes:c,updateEdges:d}=t(),s=c.filter(e=>e.selected);try{if(0===s.length)throw Error("No selected stage found or stage does not exist.");s.forEach(t=>{let s={x:t.position.x+50,y:t.position.y+50},l={...t,data:{...t.data,label:"".concat(t.data.label,"-Copy"),duplicate_from:t.id},selected:!1,dragging:!1,id:a,position:s};e({nodes:[...c,l]}),(n||r)&&d({...o,curr_stage_uuid:a})})}catch(e){b.Z.error(e.message)}},onDelete:()=>{let{nodes:o,edges:n}=t(),r=o.filter(e=>e.selected);try{if(0===r.length)throw Error("No selected stage found or stage does not exist.");p.qk.openConfirmModal({title:"Delete Stage",children:"Are you sure you want to delete the selected stage?",labels:{cancel:"Cancel",confirm:"Delete"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:()=>{let t=o.filter(e=>!e.selected),a=n.filter(e=>!r.some(t=>t.id===e.source||t.id===e.target));e({nodes:t,edges:a})}})}catch(e){b.Z.error(e.message)}},onRestore:o=>{let{previous_stage:n,next_stage:r,curr_stage_uuid:a,curr_stage_name:c}=o,{nodes:d,updateEdges:s}=t();try{if(!a)throw Error("No selected stage found or stage does not exist.");let t={id:a,data:{label:c},type:"Standard",position:{x:Math.random()*window.innerWidth-50,y:Math.random()*window.innerHeight-50}},l=[...d,t];if(e({nodes:l}),n||r){let e={...o};s(e)}}catch(e){b.Z.error(e.message)}},onDisjoint:e=>{try{let o=t().removeEdgeById,n=t().nodes.filter(e=>e.selected),{previous_stage:r,next_stage:a}=e;if(0===n.length)throw Error("No selected stage found or stage does not exist.");if(0===r.length&&0===a.length)throw Error("Pick at least one previous or next stage to disjoint.");o(e)}catch(e){b.Z.error(e.message)}},setCycleInfo:t=>{e({currentCycleInfo:t})},setNodes:t=>{e({nodes:t})},setEdges:t=>{e({edges:t})},setRfInstance:t=>{e({rfInstance:t})},toggleSelectedByNodeId:t=>{e(e=>({nodes:e.nodes.map(e=>(e.id===t?e.selected=!e.selected:e.selected=!1,e))}))},updateEdges:o=>{let{previous_stage:n,next_stage:r,curr_stage_uuid:a}=o,{edges:c}=t(),d=c.length>0?Math.max(...c.map(e=>e.id)):0,l=()=>++d,i=(e,t)=>({id:l(),source:e,target:t,type:s.t8.SmoothStep,animated:!1});try{let t=(null==n?void 0:n.map(e=>i(e,a)))||[],o=(null==r?void 0:r.map(e=>i(a,e)))||[],d=[...t,...o];e({edges:[...c,...d]})}catch(e){b.Z.error(e.message)}},removeEdges:o=>{try{let n=t().edges,r=n.filter(e=>e.source!==o&&e.target!==o);if(n.length===r.length)throw Error("No edges found for node with id ".concat(o,"."));e({edges:r})}catch(e){b.Z.error(e.message)}},removeEdgeById:o=>{try{let{edges:n,getSelectedNodeId:r}=t(),a=r(),c=o.previous_stage||[],d=o.next_stage||[],s=e=>!((c.includes(e.source)||d.includes(e.target))&&(e.source===a||e.target===a)),l=n.filter(e=>s(e));e({edges:l})}catch(e){b.Z.error(e.message)}},fetchNodesEdges:async o=>{let{cycle_id:n,apps_label:r}=o,a=t().onDraft,c=t().onLayout,d=await (0,u.B7)({cycle_id:n,apps_label:r}),{nodes:s,edges:l}=m(d.nodes.map(e=>{let{position:t,...o}=e;return{...o,position:{x:0,y:0}}}),d.edges.map(e=>{let{type:t,markerEnd:o,...n}=e;return{...n}}));e({nodes:s,edges:l}),c("TB"),a()},fetchDeletedNodes:async e=>{let{cycle_id:o,apps_label:n}=e,r=await (0,u._y)({cycle_id:o,apps_label:n});return await t().getInputOptions(r)},resetDiagramLocalStorage:()=>{let e=t().flowKey;localStorage.removeItem(e),localStorage.removeItem("wip-diagram-storage")}}),{name:"wip-diagram-storage",storage:{getItem:e=>{let t=localStorage.getItem(e);return t?r.ZP.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,r.ZP.stringify(t))},removeItem:e=>localStorage.removeItem(e)},partialize:e=>{let{flowKey:t,...o}=e;return{...o,rfInstance:null}}}));t.Z=()=>y((0,f.N)(e=>({currentCycleInfo:e.currentCycleInfo,nodes:e.nodes,edges:e.edges,generateNodeId:e.generateNodeId,getSelectedNodeId:e.getSelectedNodeId,getPreviousNodesId:e.getPreviousNodesId,getNextNodesId:e.getNextNodesId,deselectAllNodes:e.deselectAllNodes,getInputOptions:e.getInputOptions,getPreviousInputOptions:e.getPreviousInputOptions,getNextInputOptions:e.getNextInputOptions,onNodesChange:e.onNodesChange,onEdgesChange:e.onEdgesChange,onConnect:e.onConnect,onLayout:e.onLayout,onSave:e.onSave,onDraft:e.onDraft,onApply:e.onApply,onReset:e.onReset,onAdd:e.onAdd,onMove:e.onMove,onDuplicate:e.onDuplicate,onDelete:e.onDelete,onRestore:e.onRestore,onDisjoint:e.onDisjoint,fetchNodesEdges:e.fetchNodesEdges,fetchDeletedNodes:e.fetchDeletedNodes,setRfInstance:e.setRfInstance,setCycleInfo:e.setCycleInfo,toggleSelectedByNodeId:e.toggleSelectedByNodeId,updateEdges:e.updateEdges,removeEdges:e.removeEdges,resetDiagramLocalStorage:e.resetDiagramLocalStorage})))}}]);