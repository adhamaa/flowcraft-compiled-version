exports.id=3421,exports.ids=[3421],exports.modules={11519:()=>{},36714:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});let r=[]},71637:(e,t,o)=>{"use strict";o.d(t,{Z:()=>r});let r=[]},71258:(e,t,o)=>{"use strict";o.d(t,{nK:()=>r,pi:()=>n,sg:()=>s});let r=e=>e&&0===Object.keys(e).length&&e.constructor===Object;function s(e,t){let o={};return e.forEach(e=>{o[e.id]={stage_name:e.data.label,stage_uuid:e.id,list_prev:[],list_next:[],duplicate_from:e.data.duplicate_from??""}}),t.forEach(e=>{o[e.target]&&o[e.target].list_prev.push(e.source),o[e.source]&&o[e.source].list_next.push(e.target)}),Object.values(o)}let n=e=>{let t=new Date,o=new Date(e),r=Math.floor((t.getTime()-o.getTime())/1e3);if(r<60)return`${r} second${1!==r?"s":""} ago`;let s=Math.floor(r/60);if(s<60)return`${s} minute${1!==s?"s":""} ago`;let n=Math.floor(s/60);if(n<24)return`${n} hour${1!==n?"s":""} ago`;let a=Math.floor(n/24);if(a<7)return`${a} day${1!==a?"s":""} ago`;let d=Math.floor(a/7);if(d<4)return`${d} week${1!==d?"s":""} ago`;let l=Math.floor(a/30);if(l<12)return`${l} month${1!==l?"s":""} ago`;let i=Math.floor(a/365);return`${i} year${1!==i?"s":""} ago`}},6769:(e,t,o)=>{"use strict";o.d(t,{Z:()=>N});var r=o(40174),s=o(56910),n=o(1035),a=o(92767),d=o.n(a),l=o(14935),i=o(71637),c=o(36714),g=o(12530),u=o(23052),f=o(71258),p=o(34386),m=o(34778);let h=new(d()).graphlib.Graph;h.setDefaultEdgeLabel(()=>({}));let y=(e,t,o="TB")=>{let r="LR"===o;return h.setGraph({rankdir:o}),e.forEach(e=>{h.setNode(e.id,{width:250,height:200})}),t.forEach(e=>{h.setEdge(e.source,e.target)}),d().layout(h),e.forEach(e=>{let t=h.node(e.id);return e.targetPosition=r?"left":"top",e.sourcePosition=r?"right":"bottom",e.position={x:t.x-125,y:t.y-100},e}),{nodes:e,edges:t}},I=(0,r.Ue)()((0,n.tJ)((e,t)=>({flowKey:"wip-flow",currentCycleInfo:{},nodes:i.Z,edges:c.Z,rfInstance:null,generateNodeId:()=>crypto.randomUUID(),getSelectedNodeId:()=>t().nodes.find(e=>e.selected)?.id,deselectAllNodes:()=>{e({nodes:t().nodes.map(e=>({...e,selected:!1}))})},getInputOptionsByNodesId:e=>{let{nodes:o}=t();return o.filter(t=>e.includes(t.id)).map(e=>({value:e.id,label:e.data.label}))},getInputOptions:e=>e?e.map(e=>({value:e.stage_uuid,label:e.stage_name})):t().nodes.map(e=>({value:e.id,label:e.data.label})),getPreviousInputOptions:()=>{let e=t().getSelectedNodeId(),o=t().getPreviousNodesId(e);return t().getInputOptionsByNodesId(o)},getNextInputOptions:()=>{let e=t().getSelectedNodeId(),o=t().getNextNodesId(e);return t().getInputOptionsByNodesId(o)},getPreviousNodesId:e=>{let{nodes:o,edges:r}=t();return e=e??o.find(e=>e.selected)?.id,r.filter(t=>t.target===e).map(e=>e.source)},getNextNodesId:e=>{let{nodes:o,edges:r}=t();return e=e??o.find(e=>e.selected)?.id,r.filter(t=>t.source===e).map(e=>e.target)},onNodesChange:o=>{e({nodes:(0,l.Fb)(o,t().nodes)})},onEdgesChange:o=>{e({edges:(0,l.yn)(o,t().edges)})},onConnect:o=>{e({edges:(0,l.Z_)(o,t().edges)})},onLayout:o=>{let{nodes:r,edges:s}=y(t().nodes,t().edges,o);e({nodes:r,edges:s})},onSave:async({cycle_uuid:e,callback:o})=>{let r=t().onDraft;(0,t().onLayout)("TB"),m.qk.openConfirmModal({title:"Save Cycle",children:"Are you confirm to save this cycle to the latest one? ",labels:{cancel:"Cancel",confirm:"Save"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:async()=>{try{if(!e)throw Error("Cycle UUID is required.");let s=(0,f.sg)(t().nodes,t().edges);r(),await (0,g.Vp)({cycle_uuid:e,body:s}).then(t=>{if(t.error)throw Error(t.error_message);p.Z.success(t.message),o?.({success:!0,message:t.message,data:{cycle_uuid:e,...s}})})}catch(e){p.Z.error(e.message??"An error occurred while saving the cycle.")}}})},onDraft:()=>{let e=t().rfInstance,o=t().flowKey;if(e){let t=e.toObject();localStorage.setItem(o,JSON.stringify(t))}},onApply:({action:e,data:o,callback:r})=>{let s=t().onAdd,n=t().onMove,a=t().onDuplicate,d=t().onDelete,l=t().onRestore,i=t().onDisjoint;switch(e){case"add":s(o);break;case"move":n(o);break;case"duplicate":a(o);break;case"delete":d();break;case"restore":l(o);break;case"disjoint":i(o)}"function"==typeof r&&r()},onReset:o=>{let r=t().rfInstance,s=t().flowKey,n=async()=>{let t=JSON.parse(localStorage.getItem(s));if(t){let{x:s=0,y:n=0,zoom:a=1}=t.viewport;e({nodes:t.nodes||[],edges:t.edges||[]}),r?.setViewport({x:s,y:n,zoom:a}),"function"==typeof o&&o()}};m.qk.openConfirmModal({title:"Reset Cycle",children:"Are you sure you want to reset this cycle to the previous one? You canâ€™t undo this action.",labels:{cancel:"Cancel",confirm:"Reset"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:n})},onAdd:o=>{let{curr_stage_name:r="New Node",curr_stage_uuid:s,previous_stage:n,next_stage:a}=o,d=t().updateEdges;try{if(!r)throw Error("Stage name is required.");let l={id:s,type:"Standard",data:{label:r},position:{x:Math.random()*window.innerWidth-50,y:Math.random()*window.innerHeight-50}};e({nodes:[...t().nodes,l]}),(n||a)&&d({...o,curr_stage_uuid:s})}catch(e){p.Z.error(e.message)}},onMove:e=>{let{previous_stage:o,next_stage:r}=e,{nodes:s,removeEdges:n,updateEdges:a}=t(),d=s.find(e=>e.selected)?.id;try{if(!d)throw Error("No selected stage found or stage does not exist.");if(0===o.length&&0===r.length)throw Error("Pick at least one previous or next stage to move the selected stage.");n(d),a(e)}catch(e){p.Z.error(e.message)}},onDuplicate:o=>{let{previous_stage:r,next_stage:s}=o,n=t().generateNodeId(),{nodes:a,updateEdges:d}=t(),l=a.filter(e=>e.selected);try{if(0===l.length)throw Error("No selected stage found or stage does not exist.");l.forEach(t=>{let l={x:t.position.x+50,y:t.position.y+50},i={...t,data:{...t.data,label:`${t.data.label}-Copy`,duplicate_from:t.id},selected:!1,dragging:!1,id:n,position:l};e({nodes:[...a,i]}),(r||s)&&d({...o,curr_stage_uuid:n})})}catch(e){p.Z.error(e.message)}},onDelete:()=>{let{nodes:o,edges:r}=t(),s=o.filter(e=>e.selected);try{if(0===s.length)throw Error("No selected stage found or stage does not exist.");m.qk.openConfirmModal({title:"Delete Stage",children:"Are you sure you want to delete the selected stage?",labels:{cancel:"Cancel",confirm:"Delete"},radius:"md",size:"sm",overlayProps:{backgroundOpacity:.55,blur:10},withCloseButton:!1,confirmProps:{color:"var(--fc-brand-700)"},cancelProps:{color:"var(--fc-neutral-900)",variant:"light"},groupProps:{justify:"center",pb:"md"},classNames:{content:"w-96",header:"",title:"text-2xl font-semibold text-center w-full p-2",body:"flex flex-col text-center justify-center gap-6 mx-auto"},onConfirm:()=>{let t=o.filter(e=>!e.selected),n=r.filter(e=>!s.some(t=>t.id===e.source||t.id===e.target));e({nodes:t,edges:n})}})}catch(e){p.Z.error(e.message)}},onRestore:o=>{let{previous_stage:r,next_stage:s,curr_stage_uuid:n,curr_stage_name:a}=o,{nodes:d,updateEdges:l}=t();try{if(!n)throw Error("No selected stage found or stage does not exist.");let t={id:n,data:{label:a},type:"Standard",position:{x:Math.random()*window.innerWidth-50,y:Math.random()*window.innerHeight-50}},i=[...d,t];if(e({nodes:i}),r||s){let e={...o};l(e)}}catch(e){p.Z.error(e.message)}},onDisjoint:e=>{try{let o=t().removeEdgeById,r=t().nodes.filter(e=>e.selected),{previous_stage:s,next_stage:n}=e;if(0===r.length)throw Error("No selected stage found or stage does not exist.");if(0===s.length&&0===n.length)throw Error("Pick at least one previous or next stage to disjoint.");o(e)}catch(e){p.Z.error(e.message)}},setCycleInfo:t=>{e({currentCycleInfo:t})},setNodes:t=>{e({nodes:t})},setEdges:t=>{e({edges:t})},setRfInstance:t=>{e({rfInstance:t})},toggleSelectedByNodeId:t=>{e(e=>({nodes:e.nodes.map(e=>(e.id===t?e.selected=!e.selected:e.selected=!1,e))}))},updateEdges:o=>{let{previous_stage:r,next_stage:s,curr_stage_uuid:n}=o,{edges:a}=t(),d=a.length>0?Math.max(...a.map(e=>e.id)):0,i=()=>++d,c=(e,t)=>({id:i(),source:e,target:t,type:l.t8.SmoothStep,animated:!1});try{let t=r?.map(e=>c(e,n))||[],o=s?.map(e=>c(n,e))||[],d=[...t,...o];e({edges:[...a,...d]})}catch(e){p.Z.error(e.message)}},removeEdges:o=>{try{let r=t().edges,s=r.filter(e=>e.source!==o&&e.target!==o);if(r.length===s.length)throw Error(`No edges found for node with id ${o}.`);e({edges:s})}catch(e){p.Z.error(e.message)}},removeEdgeById:o=>{try{let{edges:r,getSelectedNodeId:s}=t(),n=s(),a=o.previous_stage||[],d=o.next_stage||[],l=e=>!((a.includes(e.source)||d.includes(e.target))&&(e.source===n||e.target===n)),i=r.filter(e=>l(e));e({edges:i})}catch(e){p.Z.error(e.message)}},fetchNodesEdges:async({cycle_id:o,apps_label:r})=>{let s=t().onDraft,n=t().onLayout,a=await (0,g.B7)({cycle_id:o,apps_label:r}),{nodes:d,edges:l}=y(a.nodes.map(({position:e,...t})=>({...t,position:{x:0,y:0}})),a.edges.map(({type:e,markerEnd:t,...o})=>({...o})));e({nodes:d,edges:l}),n("TB"),s()},fetchDeletedNodes:async({cycle_id:e,apps_label:o})=>{let r=await (0,g._y)({cycle_id:e,apps_label:o});return await t().getInputOptions(r)},resetDiagramLocalStorage:()=>{let e=t().flowKey;localStorage.removeItem(e),localStorage.removeItem("wip-diagram-storage")}}),{name:"wip-diagram-storage",storage:{getItem:e=>{let t=localStorage.getItem(e);return t?s.ZP.parse(t):null},setItem:(e,t)=>{localStorage.setItem(e,s.ZP.stringify(t))},removeItem:e=>localStorage.removeItem(e)},partialize:({flowKey:e,...t})=>({...t,rfInstance:null})})),N=()=>I((0,u.N)(e=>({currentCycleInfo:e.currentCycleInfo,nodes:e.nodes,edges:e.edges,generateNodeId:e.generateNodeId,getSelectedNodeId:e.getSelectedNodeId,getPreviousNodesId:e.getPreviousNodesId,getNextNodesId:e.getNextNodesId,deselectAllNodes:e.deselectAllNodes,getInputOptions:e.getInputOptions,getPreviousInputOptions:e.getPreviousInputOptions,getNextInputOptions:e.getNextInputOptions,onNodesChange:e.onNodesChange,onEdgesChange:e.onEdgesChange,onConnect:e.onConnect,onLayout:e.onLayout,onSave:e.onSave,onDraft:e.onDraft,onApply:e.onApply,onReset:e.onReset,onAdd:e.onAdd,onMove:e.onMove,onDuplicate:e.onDuplicate,onDelete:e.onDelete,onRestore:e.onRestore,onDisjoint:e.onDisjoint,fetchNodesEdges:e.fetchNodesEdges,fetchDeletedNodes:e.fetchDeletedNodes,setRfInstance:e.setRfInstance,setCycleInfo:e.setCycleInfo,toggleSelectedByNodeId:e.toggleSelectedByNodeId,updateEdges:e.updateEdges,removeEdges:e.removeEdges,resetDiagramLocalStorage:e.resetDiagramLocalStorage})))}};